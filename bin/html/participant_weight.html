<h1 id="headline"></h1>

<div>
  <label id="label_name" style="width:150px;float:left;margin-top:5px;">Name</label>
  <input style="margin-bottom:20px;" size="50" id="name" value="">
</div>

<table id="judokas" border="1" rules="all" style="margin-bottom: 1cm;">
  <tr>
    <th style="width: 0.5cm;" id="no">No.</th>
    <th style="width: 6.2cm;" id="name">Name</th>
    <th style="width: 6.2cm;" id="club">Club</th>
    <th style="width: 2cm; text-align: center;" id="weight">Weight</th>
    <th style="width: 2cm; text-align: center;" id="birthyear">Birthyear</th>
    <th style="width: 5.1cm; text-align: center;" id="options">Options</th>
  </tr>
</table>


<script>

function WeighParticipant(id)
{
  let select = document.getElementById("select_" + id);
  if (select !== null)
  {
    if (select.value == 0)
    {
        alert("Select age group");
        return false;
    }
    
    AjaxCallback('ajax/participants/weight/add?id=' + id, function() {
    });
  }
  else
    AjaxCallback('ajax/participant/add?id=' + id, Update);

  return false;
}


function RemoveWeighParticipant(id)
{
  AjaxCallback('ajax/participants/weight/remove?id=' + id, Update);
  return false;
}



function Update()
{
  AjaxCallback('ajax/judoka/search?participants=true&name=' + utf8Encode(document.getElementById("name").value), function(response) {
    console.log(response);
    const res = YAML.parse(response);

    let table = document.getElementById("judokas");

    while (table.rows.length > 1)
      table.deleteRow(table.rows.length-1);

    let no = 0;
    for (const judoka of res)
    {
      let row = table.insertRow(-1);
      let cell0 = row.insertCell(0);
      let cell1 = row.insertCell(1);
      let cell2 = row.insertCell(2);
      let cell3 = row.insertCell(3);
      let cell4 = row.insertCell(4);
      let cell5 = row.insertCell(5);

      if (no%2 == 0)
        row.style.backgroundColor = "#eee";
      no++;

      cell0.innerHTML = no;
      cell0.style.textAlign = "center";
      cell0.style.fontSize  = "16pt";

      cell1.innerHTML = judoka.firstname + ' ' + judoka.lastname;
      cell1.style.fontSize  = "16pt";

      if (typeof judoka.club_name === 'undefined')
        cell2.innerHTML = "- - -";
      else
        cell2.innerHTML = judoka.club_name;
      cell2.style.fontSize  = "16pt";

      cell3.innerHTML = judoka.weight + " kg";
      cell3.style.textAlign = "center";
      cell3.style.fontSize  = "16pt";

      cell4.innerHTML = judoka.birthyear;
      cell4.style.textAlign = "center";
      cell4.style.fontSize  = "16pt";

        
      let select = document.createElement("input");
      select.setAttribute("type", "number");
      select.style.width = "1.2cm";
      select.style.fontSize = "14pt";
      select.id  = "select_" + judoka.uuid;
      select.min = 1;
      select.max = 999;

      cell5.appendChild(select);

      cell5.innerHTML += "<button class=\"add\" style=\"width: 2.8cm; height: 0.9cm; margin-left: 5mm;\" onclick=\"return AddWeightParticipant('"+judoka.uuid+"')\">" + translate('update') + "</button>";
      cell5.style.textAlign = "right";
    }
  });
}



document.getElementById("name").oninput = function(e)
{
  Update();
};

Update();

document.getElementById("headline").innerHTML = translate('weigh_participants');
document.getElementById("no").innerHTML   = translate('no');
document.getElementById("club").innerHTML = translate('club');
document.getElementById("weight").innerHTML = translate('weight');
document.getElementById("birthyear").innerHTML = translate('birthyear');
document.getElementById("options").innerHTML = translate('options');

</script>