var lang_en = {
    access_level: [ "Access Level", "Rechte" ],
    admin:  [ "Admin", "Administrator" ],
    add: [ "Add", "Hinzuf&uuml;gen" ],
    add_match: [ "Add Match", "Kampf hinzuf&uuml;gen" ],
    add_matchtable: [ "Add Match Table", "Kampfliste hinzuf&uuml;gen" ],
    add_participant:  [ "Add Participant", "Teilnehmer  hinzuf&uuml;gen" ],
    age_group:  [ "Age group", "Altersklasse" ],
    age_groups: [ "Age groups", "Altersklassen" ],
    all:   [ "All", "Alle" ],
    all_mats: [ "All Mats", "Alle Matten" ],
    birthyear: [ "Birthyear", "Geburtsjahr" ],
    break_time: [ "Break Time", "Ruhepause" ],
    blue:   [ "Blue", "Blau" ],
    blue_wins:  [ "Blue Wins",  "Sieger Blau" ],
    both:  [ "Both",  "Beide" ],
    close:  [ "Close",  "Schlie&szlig;en" ],
    concluded:  [ "Concluded", "Beendet" ],
    change_password:  [ "Change Password", "Passwort &auml;ndern" ],
    club: [ "Club", "Verein" ],
    configuration: [ "Configuration", "Konfiguration" ],
    database:  [ "Database", "Stammdaten" ],
    details:  [ "Details", "Details" ],
    default_rule_set: [ "Default Rule Set", "Standard Regelwerk" ],
    description:  [ "Description", "Beschreibung" ],
    delete:  [ "Delete", "L&ouml;schen" ],
    delete_age_group_confirm:  [ "Are you sure you want to delete this age group?", unescape("Willst du diese Altersklasse wirklich l%F6schen?") ],
    delete_match:  [ "Delete Match", "L&ouml;sche Kampf" ],
    delete_match_confirm:  [ "Are you sure you want to delete this match?", unescape("Willst du diesen Kampf wirklich l%F6schen?") ],
    delete_matchtable_confirm:  [ "Are you sure you want to delete this match table?",  unescape("Willst du diese Kampfliste wirklich l%F6schen?") ],
    delete_account_confirm:  [ "Are you sure you want to delete this account?", unescape("Willst du dieses Benutzerkonto wirklich l%F6schen?") ],
    delete_judoka:  [ "Delete", "L&ouml;schen" ],
    delete_judoka_confirm:  [ "Are you sure you want to delete this judoka?", unescape("Willst du diesen Judoka wirklich l%F6schen?") ],
    delete_club_confirm:  [ "Are you sure you want to delete this club/association?", unescape("Willst du diesen Verein/Assoziation wirklich l%F6schen?") ],
    delete_tournament_confirm:  [ "Are you sure you want to completely delete this tournament?", unescape("Willst du wirklich dieses Turnier vollst%E4ndig l%F6schen?") ],
    delete_rules_confirm:  [ "Are you sure you want to delete this rule set?", unescape("Willst du wirklich dieses Regelwerk l%F6schen?") ],
    delete_matchtable:  [ "Delete Match Table", "Kampfliste l&ouml;schen" ],
    draw:   [ "Draw", "Unentschieden" ],
    draw_revoked:   [ "Draw revoked!", "Unentschieden zur&uuml;ckgenommen!" ],
    disabled:  [ "Disabled", "Deaktiviert" ],
    disqualification:  [ "Disqualification", "Disqualifiziert" ],
    disqualification_revoked:  [ "Disqualification revoked!", "Disqualifiziert zur&uuml;ckgenommen!" ],
    end_match:  [ "End Match", "Kampf beenden" ],
    end_of_match:  [ "End of match", "Kampf beendet" ],
    edit: [ "Edit", "&Auml;ndern" ],
    edit_account: [ "Edit Account", "Benutzerkonto &auml;ndern" ],
    edit_club: [ "Edit Club", "Verein &auml;ndern" ],
    edit_age_group: [ "Edit Age Group", "Altersklasse &auml;ndern" ],
    edit_judoka:  [ "Edit Judoka", "Judoka &auml;ndern" ],
    edit_rule_set:  [ "Edit Rule Set", "Regelwerk &auml;ndern" ],
    empty_tournament_confirm:  [ "Are you sure you want to delete all match results of this tournament?", unescape("Willst du wirklich alle Ergebnisse dieses Turnieres l%F6schen?") ],
    enabled:   [ "Enabled", "Aktiviert" ],
    event:   [ "Event", "Ereigniss" ],
    female:  [ "Female", "Weiblich" ],
    firstname:  [ "Given name", "Vorname" ],
    for:  [ "For", "F&uuml;r" ],
    gachi_revoked:  [ "Gachi revoked!", "Gachi zur&uuml;ckgenommen!" ],
    gender:  [ "Gender", "Geschlecht" ],
    goldenscore_time:  [ "Golden Score Time", "Golden Score Zeit" ],
    goldenscore_activate:  [ "Golden Score activated", "Golden Score aktiviert" ],
    goldenscore_revoked:  [ "Golden Score revoked!", "Golden Score zur&uuml;ckgenommen!" ],
    hansokumake_direct:  [ "Hansoku-Make (direct)", "Hansoku-Make (direkt)" ],
    hansokumake_indirect:  [ "Hansoku-Make (indirect)", "Hansoku-Make (indirekt)" ],
    hansokumake_revoked:  [ "Hansoku-Make revoked!", "Hansoku-Make zur&uuml;ckgenommen!" ],
    hide_mats:  [ "Hide Mats", "Matten ausblenden" ],
    import:  [ "Import", "Importieren" ],
    ippon_revoked:  [ "Ippon revoked!", "Ippon zur&uuml;ckgenommen!" ],
    judo_passport_number:  [ "Judo Passport Number", "Judopassnummer" ],
    koka_revoked:  [ "Koka revoked!", "Koka zur&uuml;ckgenommen!" ],
    list_associations:  [ "List Associations", "Verb&auml;nde anzeigen" ],
    list_clubs:  [ "List Clubs", "Vereine anzeigen" ],
    list_judokas:  [ "List Judokas", "Judokas anzeigen" ],
    list_of_accounts:  [ "List of Accounts", "Liste der Benutzerkonten" ],
    list_of_age_groups:  [ "List of Age Groups", "Liste der Altersklassen" ],
    list_accounts:  [ "List Accounts", "Benutzerkonten anzeigen" ],
    list_of_all_clubs:  [ "List of all Clubs", "Liste aller Vereine" ],
    list_of_all_associations:  [ "List of all Associations", "Liste aller Verb&auml;nde" ],
    list_of_all_judokas:  [ "List of all Judokas", "Liste aller Judokas" ],
    level:  [ "Level", "Ebene" ],
    list_of_tournaments:  [ "List of Tournaments", "Turnierliste" ],
    less:  [ "Less", "Weniger" ],
    lastname:  [ "Family name", "Nachname" ],
    lot:   [ "Lot", "Los" ],
    lots:  [ "Lots", "Lose" ],
    moderator:  [ "Moderator", "Moderator" ],
    match_table:  [ "Match Table", "Kampfliste" ],
    match_tables:  [ "Match Tables", "Kampflisten" ],
    name:  [ "Name", "Name" ],
    generate_matchtables:  [ "Generate Match Tables", "Kampflisten generieren" ],
    update_matchtable:  [ "Update Match Table", "Kampfliste &auml;ndern" ],
    matches: [ "Matches", "K&auml;mpfe" ],
    mat:  [ "Mat", "Matte" ],
    mats:  [ "Mats", "Matten" ],
    match_log:  [ "Match Log", "Kampfprotokoll" ],
    male:  [ "Male", "M&auml;nnlich" ],
    medical_examiniation:   [ "Medical Examination",  "Medizinische Untersuchung" ],
    medical_examiniation_revoked:   [ "Medical Examination revoked!",  "Medizinische Untersuchung zur&uuml;ckgenommen!" ],
    medical_examiniations:  [ "Medical Examinations", "Medizin. Untersuch." ],
    min_weight:  [ "Minimum weight", "Mindestgewicht" ],
    max_weight:  [ "Maximum weight", "Maximalgewicht" ],
    min_participants:  [ "Min participants", "Mindestteilnehmer" ],
    max_participants:  [ "Max participants", "Maximalteilnehmer" ],
    max_weight_diff:  [ "Weight difference", "Gewichtsunterschied" ],
    more:  [ "More", "Mehr" ],
    match_started:  [ "Match started", "Kampf gestartet" ],
    match_time:  [ "Match Time", "Kampfzeit" ],
    name_white:  [ "Name (White)", "Name (Wei&szlig;)" ],
    name_blue:   [ "Name (Blue)", "Name (Blau)" ],
    new_age_group: [ "New age group", "Neue Altersklasse" ],
    neutral:  [ "Neutral", "Neutral" ],
    new_account:  [ "New Account", "Neues Benutzerkonto" ],
    new_club:  [ "New Club", "Neuer Verein" ],
    new_match: [ "New Match", "Neuer Kampf" ],
    new_matchtable: [ "New Matchtable", "Neuer Kampflist" ],
    generate_matchtables: [ "Generate Matchtables", "Kampflisten generieren" ],
    new_judoka:  [ "New Judoka", "Neuer Judoka" ],    
    new_participant: ["New Participant", "Neuer Teilnehmer" ],
    new_tournament:  [ "New Tournament", "Neues Turnier" ],
    next_matches:  [ "Next Matches", "N&auml;chste K&auml;mpfe" ],
    new_rule_set:  [ "New Rule Set", "Neues Regelwerk" ],
    no:  [ "No.", "Nr." ],
    no_disqualification:  [ "No Disqualification", "Nicht disqualifiziert" ],
    no_disqualification_revoked:  [ "No Disqualification revoked!", "Nicht disqualifiziert zur&uuml;ckgenommen!" ],
    optional:   [ "Optional", "Optional" ],
    osaekomi_time_ippon:    [ "Osaekomi Time (Ippon)", "Osaekomi Zeit (Ippon)" ],
    osaekomi_time_wazaari:  [ "Osaekomi Time (Waza-Ari)", "Osaekomi Zeit (Waza-Ari)" ],
    osaekomi_switched: [ "Osaekomi switched to other fighter" , "Osaekomi auf anderen K&auml;pfer gewechselt"],
    overview:  [ "Overview", "&Uuml;bersicht" ],
    open:  [ "Oppen", "&Ouml;ffnen" ],
    optional:  [ "Optional", "Optional" ],
    participants: [ "Participants", "Teilnehmer" ],
    revoke_goldenscore: [ "Revoke Golden Score", "Golden Score zur&uuml;cknehmen" ],
    revoke_hantei: [ "Revoke Hantei", "Hantei zur&uuml;cknehmen" ],
    readonly: [ "Readonly", "Schreibschutz" ],
    rule_set:   [ "Rule Set", "Regelwerk" ],
    rule_sets:  [ "Rule Sets", "Regelwerke" ],
    remove:  [ "Remove", "Entfernen" ],
    running:   [ "Running", "am K&auml;mpfen" ],
    shutdown_confirm:  [ "Are you sure you want to shutdown Judoboard?", "Soll Judoboard wirklich heruntergefahren werden?" ],
    start:  [ "Start", "Starten" ],
    start_next_match:  [ "Start Next Match", "Kampf starten" ],
    save:  [ "Save", "Speichern" ],
    select_age_groups: [ "Select Age Groups", "Altersklassen ausw&auml;hlen" ],
    shido_revoked:  [ "Shido revoked!", "Shido zur&uuml;ckgenommen!" ],
    show_mats:  [ "Show Mats", "Matten anzeigen" ],
    show_matches_on: [ "Show matches on", "K&auml;mpfe auf Matte" ],
    status:  [ "Status", "Status" ],
    schedule:  [ "Schedule", "Zeitplan" ],
    split_genders: [ "Split Genders", "Geschlechter trennen" ],
    time:  [ "Time", "Zeit" ],
    tournament:  [ "Tournament", "Turnier" ],
    tournaments:  [ "Tournaments", "Turniere" ],
    tournament_default:  [ "Tournament Default", "Turnierstandard" ],
    password:  [ "Password", "Passwort" ],
    settings:  [ "Settings", "Einstellungen" ],
    type:  [ "Type", "Typ" ],
    score:  [ "Score", "Unterwertung" ],
    scheduled:  [ "Scheduled", "Eingeplant" ],
    skipped:   [ "Skipped", "Ausgelassen" ],
    swap_tournament_confirm:  [ "Are you sure you want to swap all white/blue fighters with each other?", unescape("Willst du wirklich alle wei\u00dfen/blauen K%E4mpfer miteinander tauschen?") ],
    push_up:  [ "Push Up", "Vorziehen" ],
    options:  [ "Options", "Optionen" ],
    pause:  [ "Pause", "Pause" ],
    parent_association:  [ "Parent Association", "H&ouml;herer Verband" ],
    organizer:  [ "Organizer", "Organisator" ],
    unpause:  [ "Unpause", "Pause beenden" ],
    upload_md5_file: [ "Upload MD5 File", "MD5 Datei hochladen" ],
    user:  [ "User", "Benutzer" ],
    username:  [ "Username", "Benutzername" ],
    update_rule_set:  [ "Update Rule Set", "&Auml;ndere Regelwerk" ],
    update_tournament:  [ "Update Tournament", "&Auml;ndere Turnier" ],
    update_account:  [ "Update Account", "Benutzerkonto &auml;ndern" ],
    update_club:   [ "Update Club", "Verein &auml;ndern" ],
    wazaari_revoked:  [ "Wazaari revoked!", "Wazaari zur&uuml;ckgenommen!" ],
    weight:  [ "Weight", "Gewicht" ],
    weightclass:  [ "Weightclass", "Gewichtsklasse" ],
    white:  [ "White", "Wei&szlig;" ],
    white_wins: [ "White Wins", "Sieger Wei&szlig" ],
    winner:  [ "Winner", "Gewinner" ],
    year: ["Year", "Jahr" ],
    yuko_revoked:  [ "Yuko revoked!", "Yuko zur&uuml;ckgenommen!" ],
    yes: ["Yes", "Ja" ],
}



function translate(keyword)
{
  console.log("Translating " + keyword);

  var ret = eval('lang_en.' + keyword);

  if (typeof ret == 'object')
    return ret[1];
  return keyword;
}


const zeroPad = (num, places) => String(num).padStart(places, '0')



function NiceTime(timestamp)
{
  return Math.floor(timestamp/(1000*60)) + ':' + zeroPad(Math.floor((timestamp/1000))%60, 2) + '.' + Math.floor((timestamp%1000)/100);
}

function NiceTimeMS(timestamp)
{
  return Math.floor(timestamp/(1000*60)) + ':' + zeroPad(Math.floor((timestamp/1000))%60, 2) + '.' + zeroPad(timestamp%1000, 3);
}

function NiceLargeTime(timestamp)
{
  return Math.floor(timestamp/(1000*60*60)) + ':' + zeroPad(Math.floor(timestamp/(1000*60)%60), 2) + ':' + zeroPad(Math.floor((timestamp/1000))%60, 2);
}



function URLEncode(obj)
{
  var str = [];
  for (var p in obj)
  {
    if (obj.hasOwnProperty(p))
      str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
  }
  return str.join("&");
}



function URLDecode(input, variable)
{
  if (typeof input === 'undefined')
    return false;

  var query = input.split("?");

  if (typeof query[1] === 'undefined')
    return false;

  var vars = query[1].split("&");

  for (var i=0;i < vars.length;i++)
  {
    var pair = vars[i].split("=");
    if (pair[0] == variable)
      return pair[1];
  }
  return false;
}



function GetQueryVariable(variable)
{
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i < vars.length;i++)
    {
          var pair = vars[i].split("=");
          if (pair[0] == variable)
            return pair[1];
    }
    return false;
}



function Ajax(url)
{
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function()
  {
    if (this.readyState == 4 && this.status == 200)
    {
      if (this.response != "ok")
        alert("Error: " + this.response);
    }
  };

  xhttp.open("GET", url);
  xhttp.send();
  return false;
}



function AjaxCallback(url, callback)
{
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function()
  {
    if (this.readyState == 4 && this.status == 200 && typeof callback !== 'undefined')
      callback(this.responseText);
  };

  xhttp.open("GET", url);
  xhttp.send();
}



function AjaxPost(url, params, callback)
{
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", url);
  xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

  xhttp.onreadystatechange = function()
  {
    if (this.readyState == 4 && this.status == 200)
    {
        if (this.response == "ok" && typeof callback !== 'undefined')
          callback();
        else if (this.response != "ok")
          alert("Error: " + this.response);
      }
  };

  xhttp.send(params);
}



function AjaxPostToYaml(url, params, callback)
{
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", url);
  xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

  xhttp.onreadystatechange = function()
  {
    if (this.readyState == 4 && this.status == 200 && typeof callback !== 'undefined')
      callback(this.responseText);
  };

  xhttp.send(params);
}



function Color(index)
{
  if (index == 1)
    return "#0bf8";
  else if (index == 2)
    return "#e338";
  else if (index == 3)
    return "#5d58";
  else if (index == 4)
    return "#ff68";
  else if (index == 5)
    return "#d0d8";
  else if (index == 6)
    return "#8658";
  else if (index == 7)
    return "#4ed8";
  else if (index == 8)
    return "#f858";
  else if (index == 9)
    return "#a0a8";
  else if (index == 10)
    return "#fe88";

  return "#fff";
}



function navigate(url)
{
  window.clearInterval(TimerID);

  window.location = '/#' + url;
  URL = url;

  if (window.innerWidth <= 900)//Mobile
    slideout.close();

  return false;
}


window.onhashchange = function(e)
{
  console.log(location.hash.slice(1));
  navigate(location.hash.slice(1));
  $( "#main" ).load(URL);
};


var StreamTimer;
var StreamUpdate = 0;

function Stream()
{
  document.getElementById("img").src = "ajax/mat/screenshot?id=1&up=" + StreamUpdate;
  StreamUpdate++;
}



function GetRuleSets(callback)
{
  AjaxCallback("ajax/rule/list", function(response) {
    console.log(response);
    var res = YAML.parse(response);

    var rules = document.getElementById("rule");

    while (rules.length >= 1)
      rules.remove(rules.length-1);

    var option = document.createElement("option");
    option.value = 0;
    option.text = "(None)";
    rules.add(option);

    for (const rule of res.rules)
    {
      var option = document.createElement("option");

      option.value = rule.uuid;

      if (typeof res.default !== 'undefined' && rule.uuid == res.default)
        option.text = rule.name + " (" + lang.tournament_default + ")";
      else
        option.text = rule.name;

      rules.add(option);
    }

    if (typeof res.default !== 'undefined' && rule.uuid == res.default)
        rules.value = res.default;

    if (typeof callback !== 'undefined')
      callback();
  });
}



function GetAgeGroups(callback)
{
  AjaxCallback("ajax/age_groups/list", function(response) {
    console.log(response);
    var res = YAML.parse(response);

    var ages = document.getElementById("age_group");

    while (ages.length >= 1)
      ages.remove(ages.length-1);

    var option = document.createElement("option");
    option.value = 0;
    option.text = "(None)";
    ages.add(option);

    for (const age of res)
    {
      var option = document.createElement("option");
      option.value = age.uuid;
      option.text  = age.name;
      ages.add(option);
    }

    if (typeof callback !== 'undefined')
      callback();
  });
}



function GetClubs(callback, query = "")
{
  AjaxCallback("ajax/club/list?" + query, function(response) {
    console.log(response);
    var res = YAML.parse(response);

    var clubs = document.getElementById("clubs");

    while (clubs.length >= 1)
      clubs.remove(clubs.length-1);

    var option = document.createElement("option");
    option.value = 0;
    option.text  = "(None)";
    clubs.add(option);

    for (const club of res)
    {
      var option = document.createElement("option");
      option.value = club.uuid;
      option.text  = club.name;
      clubs.add(option);
    }

    if (typeof callback !== 'undefined')
      callback();
  });
}



function GetAssociations(callback, query = "")
{
  AjaxCallback("ajax/association/list?" + query, function(response) {
    console.log(response);
    var res = YAML.parse(response);

    var clubs = document.getElementById("clubs");

    while (clubs.length >= 1)
      clubs.remove(clubs.length-1);

    var option = document.createElement("option");
    option.value = 0;
    option.text  = "(None)";
    clubs.add(option);

    for (const club of res)
    {
      var option = document.createElement("option");
      option.value = club.uuid;
      option.text  = club.name;
      clubs.add(option);
    }

    if (typeof callback !== 'undefined')
      callback();
  });
}



function GetColors(callback)
{
  AjaxCallback("ajax/colors/get", function(response) {
    var res = response.split(",");

    if (res.length < 1)
      return;

    var color = document.getElementById("color");

    while (color.length >= 1)
      color.remove(color.length-1);

    for (var i=0; i < res.length;)
    {
      var option = document.createElement("option");
      option.value = res[i++];
      option.text  = res[i++];
      option.style.backgroundColor = res[i++].substring(0, 4);

      color.add(option);
    }

    color.onchange = function(e)
    {
      for (var i=0; i < color.length;i++)
      {
        if (color.children[i].value == color.value)
          color.style.backgroundColor = color.children[i].style.backgroundColor;
      }
    }


    if (typeof callback !== 'undefined')
      callback();
  });
}



function GetMats(callback)
{
  AjaxCallback("ajax/config/get_mats", function(response) {
    var res = YAML.parse(response);

    if (res.length < 2)
      return;

    var ui_mats = document.getElementById("mat");

    for (const mat of res.mats)
    {
      var option = document.createElement("option");
      option.text  = mat.name;
      option.value = mat.id;

      ui_mats.add(option);
    }

    if (typeof callback !== 'undefined')
      callback();
  });
}